{% extends "base.html" %}
{% block content %}

<div class="container my-5">
  <h2 class="mb-1">Availability Manager</h2>
  <p class="text-muted">Set your weekly availability (30-minute slots)</p>

  <form method="POST" action="{{ url_for('update_availability') }}">

    {% set days = [
      ('Monday',0),('Tuesday',1),('Wednesday',2),
      ('Thursday',3),('Friday',4),('Saturday',5),('Sunday',6)
    ] %}
    <div class="mb-3">
      <button type="button"
              class="btn btn-sm btn-outline-secondary"
              onclick="copyMondayToAll()">
        Copy Monday to All Days
      </button>
    </div>
    <div class="card shadow-sm rounded-4 overflow-hidden">
      <div class="card-header bg-dark text-white">
        Weekly Availability
      </div>

      <div class="list-group list-group-flush">
        {% for day, idx in days %}
        <div class="list-group-item py-4">
          <div class="row align-items-center">

            <!-- Day Toggle -->
            <div class="col-md-3">
              <label class="fw-bold">
                <input type="checkbox"
                       name="day_{{ day }}_active"
                       {% if weekly.get(idx) %}checked{% endif %}>
                {{ day }}
              </label>
            </div>

            <!-- Start Time -->
            <div class="col-md-3">
              <input type="time"
                     name="day_{{ day }}_start"
                     class="form-control"
                     value="{{ weekly[idx].start if weekly.get(idx) else '09:00' }}">
            </div>

            <!-- End Time -->
            <div class="col-md-3">
              <input type="time"
                     name="day_{{ day }}_end"
                     class="form-control"
                     value="{{ weekly[idx].end if weekly.get(idx) else '17:00' }}">
            </div>

          </div>
        </div>
        {% endfor %}
      </div>

      <!-- Blocked Dates -->
      <div class="p-4 border-top bg-light">
        <label class="fw-bold">Block Specific Dates</label>
        <input type="text"
               name="blocked_dates"
               class="form-control"
               placeholder="YYYY-MM-DD, YYYY-MM-DD">
      </div>

      <div class="p-4">
        <button class="btn btn-primary w-100 rounded-pill py-2">
          Save Availability
        </button>
      </div>
    </div>

  </form>
</div>
<script>
function copyMondayToAll() {
  // Get Monday values
  const mondayStart = document.querySelector('[name="day_Monday_start"]').value;
  const mondayEnd   = document.querySelector('[name="day_Monday_end"]').value;

  if (!mondayStart || !mondayEnd) {
    alert("Set Monday time first");
    return;
  }

  const days = [
    "Tuesday", "Wednesday", "Thursday",
    "Friday", "Saturday", "Sunday"
  ];

  days.forEach(day => {
    const activeCheckbox = document.querySelector(`[name="day_${day}_active"]`);
    const startInput = document.querySelector(`[name="day_${day}_start"]`);
    const endInput   = document.querySelector(`[name="day_${day}_end"]`);

    // Only copy if day is enabled
    if (activeCheckbox && activeCheckbox.checked) {
      startInput.value = mondayStart;
      endInput.value   = mondayEnd;
    }
  });
}
</script>

{% endblock %}
